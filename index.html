<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Country Knowledge Challenge</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }
        
        /* Custom mobile animations */
        @keyframes mobilePress {
          0% { transform: scale(1); }
          50% { transform: scale(0.95); }
          100% { transform: scale(1); }
        }
        
        .mobile-press {
          animation: mobilePress 0.15s ease-out;
        }
        
        /* Better mobile scrolling */
        .mobile-scroll {
          -webkit-overflow-scrolling: touch;
        }
        
        /* Haptic feedback simulation */
        .haptic-light {
          animation: pulse 0.1s ease-out;
        }
        
        @keyframes pulse {
          0% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.05); opacity: 0.8; }
          100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const countries = [
          { 
            name: 'Russia', 
            area: 17098242, 
            population: 144104080, 
            gdp: 2240000000000,
            flagCode: 'ru'
          },
          { 
            name: 'Canada', 
            area: 9984670, 
            population: 38246108, 
            gdp: 2140000000000,
            flagCode: 'ca'
          },
          { 
            name: 'United States', 
            area: 9833517, 
            population: 331900000, 
            gdp: 25460000000000,
            flagCode: 'us'
          },
          { 
            name: 'China', 
            area: 9596960, 
            population: 1412000000, 
            gdp: 17730000000000,
            flagCode: 'cn'
          },
          { 
            name: 'Brazil', 
            area: 8514877, 
            population: 215300000, 
            gdp: 2610000000000,
            flagCode: 'br'
          },
          { 
            name: 'Australia', 
            area: 7692024, 
            population: 25690000, 
            gdp: 1550000000000,
            flagCode: 'au'
          },
          { 
            name: 'India', 
            area: 3287263, 
            population: 1380000000, 
            gdp: 3740000000000,
            flagCode: 'in'
          },
          { 
            name: 'Argentina', 
            area: 2780400, 
            population: 45380000, 
            gdp: 630000000000,
            flagCode: 'ar'
          },
          { 
            name: 'Kazakhstan', 
            area: 2724900, 
            population: 19400000, 
            gdp: 220000000000,
            flagCode: 'kz'
          },
          { 
            name: 'Algeria', 
            area: 2381741, 
            population: 44700000, 
            gdp: 190000000000,
            flagCode: 'dz'
          },
          { 
            name: 'Saudi Arabia', 
            area: 2149690, 
            population: 35000000, 
            gdp: 830000000000,
            flagCode: 'sa'
          },
          { 
            name: 'Mexico', 
            area: 1964375, 
            population: 128900000, 
            gdp: 1640000000000,
            flagCode: 'mx'
          },
          { 
            name: 'Indonesia', 
            area: 1904569, 
            population: 273500000, 
            gdp: 1320000000000,
            flagCode: 'id'
          },
          { 
            name: 'Turkey', 
            area: 783562, 
            population: 84340000, 
            gdp: 820000000000,
            flagCode: 'tr'
          },
          { 
            name: 'Iran', 
            area: 1648195, 
            population: 85000000, 
            gdp: 360000000000,
            flagCode: 'ir'
          }
        ];

        const rounds = [
          { 
            id: 1, 
            title: 'Land Area', 
            instruction: 'Rank by largest to smallest land area',
            metric: 'area',
            icon: '🗺️',
            points: 1
          },
          { 
            id: 2, 
            title: 'Population', 
            instruction: 'Rank by largest to smallest population',
            metric: 'population',
            icon: '👥',
            points: 2
          },
          { 
            id: 3, 
            title: 'GDP', 
            instruction: 'Rank by highest to lowest GDP',
            metric: 'gdp',
            icon: '💰',
            points: 3
          }
        ];

        function CountrySizeGame() {
          const [currentCountries, setCurrentCountries] = useState([]);
          const [userRanking, setUserRanking] = useState([]);
          const [gameState, setGameState] = useState('playing');
          const [currentRound, setCurrentRound] = useState(1);
          const [roundScores, setRoundScores] = useState([]);
          const [totalGamesPlayed, setTotalGamesPlayed] = useState(0);
          const [totalScore, setTotalScore] = useState(0);
          const [pressedCard, setPressedCard] = useState(null);

          const getRandomCountries = () => {
            const shuffled = [...countries].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, 3);
          };

          const startNewGame = () => {
            const newCountries = getRandomCountries();
            setCurrentCountries(newCountries);
            setUserRanking([]);
            setGameState('playing');
            setCurrentRound(1);
            setRoundScores([]);
          };

          const startNextRound = () => {
            setUserRanking([]);
            setGameState('playing');
            setCurrentRound(prev => prev + 1);
          };

          useEffect(() => {
            startNewGame();
          }, []);

          // Mobile haptic feedback simulation
          const triggerHaptic = () => {
            if (navigator.vibrate) {
              navigator.vibrate(50);
            }
          };

          const handleCountryPress = (country) => {
            setPressedCard(country.name);
            triggerHaptic();
            setTimeout(() => setPressedCard(null), 150);
            handleCountryClick(country);
          };

          const handleCountryClick = (country) => {
            if (gameState !== 'playing') return;
            
            if (userRanking.find(item => item.country.name === country.name)) {
              setUserRanking(prev => prev.filter(item => item.country.name !== country.name));
            } else if (userRanking.length < 3) {
              const position = userRanking.length + 1;
              setUserRanking(prev => [...prev, { country, position }]);
            }
          };

          const submitRanking = () => {
            if (userRanking.length !== 3) return;
            
            triggerHaptic();
            const currentRoundData = rounds[currentRound - 1];
            const metric = currentRoundData.metric;
            
            const correctOrder = [...currentCountries].sort((a, b) => b[metric] - a[metric]);
            
            const userOrder = userRanking
              .sort((a, b) => a.position - b.position)
              .map(item => item.country.name);
            
            const correctOrderNames = correctOrder.map(country => country.name);
            const isCorrect = JSON.stringify(userOrder) === JSON.stringify(correctOrderNames);
            
            const roundPoints = [1, 2, 3][currentRound - 1];
            const pointsEarned = isCorrect ? roundPoints : 0;
            
            const newRoundScore = { round: currentRound, correct: isCorrect, points: pointsEarned };
            const updatedRoundScores = [...roundScores, newRoundScore];
            setRoundScores(updatedRoundScores);
            
            if (currentRound === 3) {
              const gameScore = updatedRoundScores.reduce((sum, score) => sum + score.points, 0);
              setTotalScore(prev => prev + gameScore);
              setTotalGamesPlayed(prev => prev + 1);
              setGameState('gameFinished');
            } else {
              setGameState('roundFinished');
            }
          };

          const getRankForCountry = (country) => {
            const ranking = userRanking.find(item => item.country.name === country.name);
            return ranking ? ranking.position : null;
          };

          const getCorrectOrder = () => {
            const currentRoundData = rounds[currentRound - 1];
            const metric = currentRoundData.metric;
            return [...currentCountries].sort((a, b) => b[metric] - a[metric]);
          };

          const formatValue = (value, metric) => {
            switch (metric) {
              case 'area':
                return (value / 1000000).toFixed(1) + 'M km²';
              case 'population':
                return (value / 1000000).toFixed(1) + 'M people';
              case 'gdp':
                return '$' + (value / 1000000000000).toFixed(1) + 'T';
              default:
                return value;
            }
          };

          const getCurrentRoundData = () => rounds[currentRound - 1];

          const getTotalGamePoints = () => {
            return roundScores.reduce((sum, score) => sum + score.points, 0);
          };

          return (
            <div className="min-h-screen bg-gray-900 text-white mobile-scroll">
              <div className="max-w-4xl mx-auto p-4 sm:p-8">
                {/* Header - Mobile Optimized */}
                <div className="text-center mb-6">
                  <h1 className="text-3xl sm:text-4xl font-bold mb-4">Country Challenge</h1>
                  
                  {/* Round Progress - Stack on Mobile */}
                  <div className="flex flex-col sm:flex-row justify-center items-center gap-3 sm:gap-6 mb-4">
                    {rounds.map((round, index) => (
                      <div 
                        key={round.id}
                        className={`flex items-center gap-2 px-3 sm:px-4 py-2 rounded-lg border-2 text-sm sm:text-base ${
                          currentRound === round.id 
                            ? 'border-blue-500 bg-blue-900/30' 
                            : currentRound > round.id 
                              ? (roundScores[index]?.correct ? 'border-green-500 bg-green-900/30' : 'border-red-500 bg-red-900/30')
                              : 'border-gray-600 bg-gray-800'
                        }`}
                      >
                        <span className="text-lg sm:text-xl">{round.icon}</span>
                        <span className="font-semibold">R{round.id}: {round.title}</span>
                        <span className="text-xs sm:text-sm text-gray-400">({round.points}pt)</span>
                        {currentRound > round.id && (
                          <span className={`ml-1 ${roundScores[index]?.correct ? 'text-green-400' : 'text-red-400'}`}>
                            {roundScores[index]?.correct ? '✓' : '✗'}
                          </span>
                        )}
                      </div>
                    ))}
                  </div>
                  
                  {gameState !== 'gameFinished' && (
                    <p className="text-base sm:text-lg text-gray-300 mb-4 px-4">
                      {getCurrentRoundData().instruction}
                    </p>
                  )}
                  
                  <div className="text-sm text-gray-400">
                    Total Score: {totalScore}/{totalGamesPlayed * 6} points
                    {totalGamesPlayed > 0 && ` (${Math.round((totalScore/(totalGamesPlayed * 6)) * 100)}%)`}
                  </div>
                </div>

                {/* Country Cards - Mobile First Design */}
                <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-6">
                  {currentCountries.map((country, index) => {
                    const rank = getRankForCountry(country);
                    const isPressed = pressedCard === country.name;
                    return (
                      <div
                        key={country.name}
                        onClick={() => handleCountryPress(country)}
                        className={`
                          relative bg-gray-800 rounded-xl p-6 sm:p-6 cursor-pointer transition-all duration-200 border-2
                          ${rank ? 'border-blue-500 bg-blue-900/20' : 'border-gray-600'}
                          ${gameState === 'playing' ? 'active:scale-95' : 'cursor-default'}
                          ${isPressed ? 'mobile-press' : ''}
                          min-h-[180px] sm:min-h-[200px]
                        `}
                        style={{
                          transform: isPressed ? 'scale(0.98)' : 'scale(1)',
                          touchAction: 'manipulation'
                        }}
                      >
                        {/* Rank Badge - Bigger on Mobile */}
                        {rank && (
                          <div className="absolute -top-2 -right-2 bg-blue-500 text-white rounded-full w-10 h-10 sm:w-8 sm:h-8 flex items-center justify-center font-bold text-lg sm:text-base shadow-lg">
                            {rank}
                          </div>
                        )}
                        
                        {/* Country Flag - Much Larger on Mobile */}
                        <div className="h-24 sm:h-20 flex items-center justify-center mb-4">
                          <img 
                            src={`https://hatscripts.github.io/circle-flags/flags/${country.flagCode}.svg`}
                            alt={country.name}
                            className="w-20 h-20 sm:w-16 sm:h-16 rounded-full shadow-lg"
                            onError={(e) => {
                              e.target.style.display = 'none';
                              e.target.nextSibling.style.display = 'block';
                            }}
                          />
                          <div 
                            className="w-20 h-20 sm:w-16 sm:h-16 bg-gray-600 rounded-full flex items-center justify-center text-2xl sm:text-xl font-bold hidden"
                          >
                            {country.name.charAt(0)}
                          </div>
                        </div>
                        
                        {/* Country Name - Bigger Font on Mobile */}
                        <h3 className="text-xl sm:text-lg font-semibold text-center leading-tight">{country.name}</h3>
                        
                        {/* Metric Values */}
                        {(gameState === 'roundFinished' || gameState === 'gameFinished') && (
                          <p className="text-sm text-gray-400 text-center mt-3">
                            {formatValue(country[getCurrentRoundData().metric], getCurrentRoundData().metric)}
                          </p>
                        )}
                      </div>
                    );
                  })}
                </div>

                {/* User Ranking Display - Mobile Optimized */}
                {userRanking.length > 0 && (
                  <div className="mb-6 bg-gray-800/50 rounded-xl p-4">
                    <h3 className="text-lg font-semibold mb-3 text-center">Your Ranking:</h3>
                    <div className="flex gap-4 justify-center flex-wrap">
                      {userRanking
                        .sort((a, b) => a.position - b.position)
                        .map((item, index) => (
                          <div key={item.country.name} className="text-center bg-gray-700 rounded-lg p-3">
                            <div className="text-xl sm:text-2xl font-bold text-blue-400">#{item.position}</div>
                            <div className="text-sm font-medium">{item.country.name}</div>
                          </div>
                        ))}
                    </div>
                  </div>
                )}

                {/* Submit Button - Sticky on Mobile */}
                {gameState === 'playing' && userRanking.length === 3 && (
                  <div className="sticky bottom-4 sm:static text-center mb-6">
                    <button
                      onClick={submitRanking}
                      className="bg-blue-600 hover:bg-blue-700 active:bg-blue-800 px-8 py-4 sm:py-3 rounded-xl font-semibold transition-colors text-lg sm:text-base shadow-lg w-full sm:w-auto max-w-xs"
                    >
                      Submit Round {currentRound}
                    </button>
                  </div>
                )}

                {/* Results - Mobile Bottom Sheet Style */}
                {gameState === 'roundFinished' && (
                  <div className="mb-6">
                    <div className="bg-gray-800 rounded-xl p-6 mb-4 border border-gray-700">
                      <h3 className="text-xl font-semibold mb-4 text-center">
                        Round {currentRound} Results
                      </h3>
                      <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                        {getCorrectOrder().map((country, index) => (
                          <div key={country.name} className="text-center bg-gray-700 rounded-lg p-4">
                            <div className="text-2xl font-bold text-green-400">#{index + 1}</div>
                            <div className="font-semibold text-lg">{country.name}</div>
                            <div className="text-sm text-gray-400 mt-1">
                              {formatValue(country[getCurrentRoundData().metric], getCurrentRoundData().metric)}
                            </div>
                          </div>
                        ))}
                      </div>
                      <div className="text-center">
                        <div className="text-lg font-bold mb-4">
                          {roundScores[roundScores.length - 1]?.correct ? (
                            <span className="text-green-400">✓ Correct! +{currentRound} point{currentRound > 1 ? 's' : ''}</span>
                          ) : (
                            <span className="text-red-400">✗ Incorrect - 0 points</span>
                          )}
                        </div>
                        <button
                          onClick={startNextRound}
                          className="bg-blue-600 hover:bg-blue-700 active:bg-blue-800 px-8 py-3 rounded-xl font-semibold transition-colors w-full sm:w-auto"
                        >
                          Continue to Round {currentRound + 1}
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Final Results - Mobile Optimized */}
                {gameState === 'gameFinished' && (
                  <div className="mb-6">
                    <div className="bg-gray-800 rounded-xl p-6 mb-4 border border-gray-700">
                      <h3 className="text-2xl font-bold mb-4 text-center">Game Complete! 🎉</h3>
                      <div className="text-4xl sm:text-3xl font-bold mb-6 text-center">
                        {getTotalGamePoints()}/6 points
                      </div>
                      
                      <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                        {rounds.map((round, index) => (
                          <div key={round.id} className="text-center p-4 bg-gray-700 rounded-lg">
                            <div className="text-lg font-semibold">{round.icon} {round.title}</div>
                            <div className="text-sm text-gray-400 mb-2">{round.points} point{round.points > 1 ? 's' : ''}</div>
                            <div className={`text-2xl font-bold ${
                              roundScores[index]?.correct ? 'text-green-400' : 'text-red-400'
                            }`}>
                              {roundScores[index]?.correct ? `+${round.points}` : '0'}
                            </div>
                          </div>
                        ))}
                      </div>
                      
                      <div className="text-lg text-gray-300 mb-6 text-center">
                        {getTotalGamePoints() === 6 ? 'Perfect score! 🎉' : 
                         getTotalGamePoints() >= 4 ? 'Great job! 👏' :
                         getTotalGamePoints() >= 2 ? 'Good effort! 👍' : 'Keep trying! 💪'}
                      </div>
                      
                      <div className="text-center">
                        <button
                          onClick={startNewGame}
                          className="bg-green-600 hover:bg-green-700 active:bg-green-800 px-8 py-4 rounded-xl font-semibold transition-colors text-lg w-full sm:w-auto"
                        >
                          Play New Game
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Instructions - Mobile Friendly */}
                {gameState === 'playing' && userRanking.length === 0 && (
                  <div className="text-center text-gray-400 bg-gray-800/50 rounded-xl p-4 mx-4 sm:mx-0">
                    <p className="text-base">👆 Tap countries to rank them 1→2→3</p>
                  </div>
                )}
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CountrySizeGame />);
    </script>
</body>
</html>
